<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1360 980" font-family="Inter, system-ui, -apple-system, Segoe UI, sans-serif" font-size="13">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 Z" fill="#334155"/>
    </marker>
    <marker id="arrOpt" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 Z" fill="#94a3b8"/>
    </marker>
    <marker id="arrUp" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 Z" fill="#2563eb"/>
    </marker>
  </defs>

  <rect width="1360" height="980" fill="#f8fafc"/>

  <!-- User -->
  <rect x="580" y="24" width="200" height="52" rx="26" fill="#3b82f6" stroke="#2563eb"/>
  <text x="680" y="56" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Telegram User</text>

  <!-- Bot -->
  <rect x="120" y="106" width="1120" height="144" rx="12" fill="#eaf2ff" stroke="#93c5fd"/>
  <text x="680" y="138" text-anchor="middle" fill="#1e40af" font-size="16" font-weight="700">Bot</text>
  <text x="680" y="156" text-anchor="middle" fill="#2563eb" font-size="11" font-style="italic">bot.Service</text>

  <rect x="150" y="178" width="200" height="42" rx="8" fill="#ffffff" stroke="#93c5fd"/>
  <text x="250" y="204" text-anchor="middle" fill="#1e3a8a" font-size="12" font-weight="600">Auth</text>

  <rect x="380" y="178" width="200" height="42" rx="8" fill="#ffffff" stroke="#93c5fd"/>
  <text x="480" y="204" text-anchor="middle" fill="#1e3a8a" font-size="12" font-weight="600">Router</text>

  <rect x="610" y="178" width="200" height="42" rx="8" fill="#ffffff" stroke="#93c5fd"/>
  <text x="710" y="204" text-anchor="middle" fill="#1e3a8a" font-size="12" font-weight="600">Handlers</text>

  <rect x="840" y="178" width="200" height="42" rx="8" fill="#ffffff" stroke="#93c5fd"/>
  <text x="940" y="204" text-anchor="middle" fill="#1e3a8a" font-size="12" font-weight="600">Sessions</text>

  <text x="250" y="236" text-anchor="middle" fill="#64748b" font-size="10">login, roles, temp pwd</text>
  <text x="710" y="236" text-anchor="middle" fill="#64748b" font-size="10">/ls /rm /start /temp, callbacks</text>

  <!-- App -->
  <rect x="500" y="282" width="360" height="62" rx="10" fill="#e7fbff" stroke="#67e8f9"/>
  <text x="680" y="309" text-anchor="middle" fill="#0f766e" font-size="15" font-weight="700">App</text>
  <text x="680" y="327" text-anchor="middle" fill="#0891b2" font-size="11">Bot + DB + Config + DownloadManager</text>

  <!-- Core -->
  <rect x="80" y="380" width="250" height="120" rx="10" fill="#fff7ed" stroke="#fdba74"/>
  <text x="205" y="410" text-anchor="middle" fill="#c2410c" font-size="14" font-weight="700">Database</text>
  <text x="205" y="430" text-anchor="middle" fill="#ea580c" font-size="11" font-style="italic">database.Database</text>
  <text x="205" y="450" text-anchor="middle" fill="#64748b" font-size="11">SQLite</text>
  <text x="205" y="474" text-anchor="middle" fill="#64748b" font-size="10">MovieReader | MovieWriter | AuthStore</text>

  <rect x="400" y="380" width="560" height="120" rx="12" fill="#ecfdf3" stroke="#86efac"/>
  <text x="680" y="410" text-anchor="middle" fill="#166534" font-size="16" font-weight="700">Download Manager</text>
  <text x="680" y="430" text-anchor="middle" fill="#15803d" font-size="11" font-style="italic">manager.Service</text>

  <rect x="430" y="448" width="150" height="36" rx="8" fill="#ffffff" stroke="#86efac"/>
  <text x="505" y="471" text-anchor="middle" fill="#166534" font-size="11">Queue</text>
  <rect x="605" y="448" width="170" height="36" rx="8" fill="#ffffff" stroke="#86efac"/>
  <text x="690" y="471" text-anchor="middle" fill="#166534" font-size="11">Semaphore</text>
  <rect x="800" y="448" width="130" height="36" rx="8" fill="#ffffff" stroke="#86efac"/>
  <text x="865" y="471" text-anchor="middle" fill="#166534" font-size="11">Monitor</text>

  <rect x="1030" y="380" width="250" height="120" rx="10" fill="#ffffff" stroke="#cbd5e1" stroke-dasharray="6,4"/>
  <text x="1155" y="406" text-anchor="middle" fill="#94a3b8" font-size="10">optional</text>
  <text x="1155" y="432" text-anchor="middle" fill="#334155" font-size="14" font-weight="700">Prowlarr</text>
  <text x="1155" y="452" text-anchor="middle" fill="#6b7280" font-size="11">torrent search</text>

  <!-- Downloaders -->
  <rect x="210" y="540" width="260" height="88" rx="10" fill="#faf5ff" stroke="#d8b4fe"/>
  <text x="340" y="572" text-anchor="middle" fill="#6b21a8" font-size="15" font-weight="700">yt-dlp</text>
  <text x="340" y="592" text-anchor="middle" fill="#6b7280" font-size="11">streaming video</text>
  <text x="340" y="610" text-anchor="middle" fill="#6b7280" font-size="10">YouTube | VK | RuTube | ...</text>

  <rect x="760" y="540" width="260" height="88" rx="10" fill="#fdf2f8" stroke="#f9a8d4"/>
  <text x="890" y="572" text-anchor="middle" fill="#be123c" font-size="15" font-weight="700">aria2</text>
  <text x="890" y="592" text-anchor="middle" fill="#6b7280" font-size="11">torrents</text>
  <text x="890" y="610" text-anchor="middle" fill="#6b7280" font-size="10">single-file | multi-file</text>

  <!-- Storage -->
  <rect x="80" y="664" width="260" height="80" rx="10" fill="#eef2ff" stroke="#a5b4fc"/>
  <text x="210" y="696" text-anchor="middle" fill="#3730a3" font-size="14" font-weight="700">File Manager</text>
  <text x="210" y="716" text-anchor="middle" fill="#6b7280" font-size="10">disk space | cleanup | temp files</text>

  <rect x="500" y="664" width="360" height="80" rx="10" fill="#fefce8" stroke="#fde047"/>
  <text x="680" y="696" text-anchor="middle" fill="#a16207" font-size="14" font-weight="700">File Storage</text>
  <text x="680" y="716" text-anchor="middle" fill="#6b7280" font-size="12">MOVIE_PATH</text>

  <rect x="930" y="664" width="320" height="80" rx="10" fill="#ffffff" stroke="#cbd5e1" stroke-dasharray="6,4"/>
  <text x="1090" y="688" text-anchor="middle" fill="#94a3b8" font-size="10">optional</text>
  <text x="1090" y="708" text-anchor="middle" fill="#334155" font-size="14" font-weight="700">TV Compat</text>
  <text x="1090" y="726" text-anchor="middle" fill="#6b7280" font-size="10">ffmpeg | ffprobe | remux</text>

  <!-- Output -->
  <rect x="530" y="786" width="300" height="62" rx="10" fill="#ffffff" stroke="#cbd5e1" stroke-dasharray="6,4"/>
  <text x="680" y="810" text-anchor="middle" fill="#94a3b8" font-size="10">optional</text>
  <text x="680" y="830" text-anchor="middle" fill="#334155" font-size="14" font-weight="700">DLNA | minidlna</text>

  <rect x="580" y="886" width="200" height="56" rx="28" fill="#64748b" stroke="#475569"/>
  <text x="680" y="920" text-anchor="middle" fill="#ffffff" font-size="15" font-weight="700">Smart TV</text>

  <!-- Meta -->
  <rect x="1030" y="540" width="250" height="88" rx="10" fill="#f8fafc" stroke="#cbd5e1" stroke-dasharray="6,4"/>
  <text x="1155" y="566" text-anchor="middle" fill="#94a3b8" font-size="10">test infrastructure</text>
  <text x="1155" y="590" text-anchor="middle" fill="#334155" font-size="13" font-weight="700">testutils</text>
  <text x="1155" y="608" text-anchor="middle" fill="#6b7280" font-size="10">MockBot, DatabaseStub</text>
  <text x="1155" y="622" text-anchor="middle" fill="#6b7280" font-size="10">TestConfig, TestDatabase</text>

  <rect x="80" y="886" width="420" height="56" rx="10" fill="none" stroke="#dbe3ee"/>
  <text x="98" y="910" fill="#334155" font-size="12" font-weight="700">Legend</text>
  <line x1="98" y1="924" x2="136" y2="924" stroke="#334155" stroke-width="2"/>
  <text x="144" y="928" fill="#64748b" font-size="11">required</text>
  <line x1="232" y1="924" x2="270" y2="924" stroke="#94a3b8" stroke-width="1.6" stroke-dasharray="6,4"/>
  <text x="278" y="928" fill="#64748b" font-size="11">optional</text>
  <text x="98" y="942" fill="#64748b" font-size="11" font-style="italic">downloader.Downloader = testable interface boundary</text>

  <!-- ========== ARROWS (drawn last = always on top) ========== -->
  <g stroke-linecap="round" stroke-linejoin="round" fill="none">

    <!-- User -> Bot : straight vertical -->
    <line x1="660" y1="76" x2="660" y2="110" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>
    <text x="648" y="96" text-anchor="end" fill="#64748b" font-size="10" fill-opacity="1">links / .torrent / commands</text>

    <!-- Bot -> User (notifications) : straight vertical up -->
    <line x1="700" y1="110" x2="700" y2="76" stroke="#2563eb" stroke-width="1.8" marker-end="url(#arrUp)"/>
    <text x="712" y="96" fill="#2563eb" font-size="10">notifications</text>

    <!-- Bot -> App : straight vertical -->
    <line x1="680" y1="250" x2="680" y2="286" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- App -> Database : L-shape (left then down) -->
    <path d="M500,313 H205 V384" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- App -> Download Manager : straight vertical -->
    <line x1="680" y1="344" x2="680" y2="384" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- Bot -> Prowlarr (optional) : straight vertical -->
    <line x1="1155" y1="250" x2="1155" y2="384" stroke="#94a3b8" stroke-width="1.6" stroke-dasharray="6,4" marker-end="url(#arrOpt)"/>
    <text x="1165" y="320" fill="#94a3b8" font-size="10">search</text>

    <!-- DM -> yt-dlp : straight vertical -->
    <line x1="435" y1="500" x2="435" y2="544" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- DM -> aria2 : straight vertical -->
    <line x1="860" y1="500" x2="860" y2="544" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- interface label between DM and downloaders -->
    <text x="680" y="526" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">downloader.Downloader</text>

    <!-- DM -> File Manager : routed along left margin to avoid yt-dlp -->
    <path d="M400,500 V520 H60 V704 H84" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- DM -> TV Compat (optional) : routed along right margin to avoid aria2 -->
    <path d="M960,500 V520 H1300 V704 H1246" stroke="#94a3b8" stroke-width="1.6" stroke-dasharray="6,4" marker-end="url(#arrOpt)"/>

    <!-- yt-dlp -> File Storage : L-shape (down then right) -->
    <path d="M360,628 V704 H504" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- aria2 -> File Storage : straight vertical -->
    <line x1="810" y1="628" x2="810" y2="668" stroke="#334155" stroke-width="2" marker-end="url(#arr)"/>

    <!-- File Storage -> DLNA (optional) : straight vertical -->
    <line x1="680" y1="744" x2="680" y2="790" stroke="#94a3b8" stroke-width="1.6" stroke-dasharray="6,4" marker-end="url(#arrOpt)"/>

    <!-- DLNA -> Smart TV (optional) : straight vertical -->
    <line x1="680" y1="848" x2="680" y2="890" stroke="#94a3b8" stroke-width="1.6" stroke-dasharray="6,4" marker-end="url(#arrOpt)"/>

  </g>
</svg>
